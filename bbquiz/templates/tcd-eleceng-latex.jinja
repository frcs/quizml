\documentclass{tcdexams}

%% loading information to template
%% environment = jinja2.Environment(loader=loader, trim_blocks=True,block_start_string='@@'
%% ,block_end_string='@@',variable_start_string='@=', variable_end_string='=@')

<# passing the header variables to template #>
<| for key, value in header.items()      -|>
<|   if key != 'type'                     |>
\def \info<<key>> {<<value>>}
<|   endif           |>  
<|- endfor                                |>

\providecommand{\infoprogrammeyearname}{}
\providecommand{\infoexamsemester}{}
\providecommand{\infoexamyear}{}
\providecommand{\infoexamdate}{}
\providecommand{\infoexamtime}{}
\providecommand{\infoexamvenue}{}
\providecommand{\infomodulename}{}
\providecommand{\infomodulecode}{}
\providecommand{\infoexaminer}{}
\providecommand{\infoinstructions}{}
\providecommand{\infomaterials}{}
\providecommand{\infoadditionalinformation}{}


\programmeyearname{\infoprogrammeyearname}
\examsemester{\infoexamsemester}
\examyear{\infoexamyear}
\examdate{\infoexamdate}
\examtime{\infoexamtime}
\examvenue{\infoexamvenue}
\modulename{\infomodulename}
\modulecode{\infomodulecode}
\examiner{\infoexaminer}
\instructions{\infoinstructions}
\materials{\infomaterials}
\additionalinformation{\infoadditionalinformation}

\usepackage{longtable,booktabs}


%% rest of the template
\usepackage{amsmath,amssymb}

\providecommand{\tightlist}
{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\usepackage[totalmarks]{examquestions}
\usepackage{listings}
\lstset{frame=l,
  language=python,
  basicstyle=\ttfamily\scriptsize,
  numbers=left,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{green}\ttfamily,
  stringstyle=\color{red},
  texcl=false}

\newcounter{bbquestion}
\newenvironment{bbquestion}[1][]{\sbox\qmarks{\bfseries #1 marks}
\refstepcounter{bbquestion}\par\medskip\textbf{Q.\thebbquestion.}
\hfill\begin{minipage}[t]{0.92\textwidth}}{\hspace*{0em plus 1fill}
\makebox{\bfseries [\usebox{\qmarks}]}\end{minipage}
\vspace{\subquestionskip}}


\usepackage{tikz,pgfplots,environ}
\usetikzlibrary{matrix,chains,positioning,decorations.pathreplacing,arrows,backgrounds}

\usepackage{parskip,setspace,xspace}
\onehalfspacing

\usepackage{etoolbox}
\usepackage{ifxetex}
\usepackage{ifluatex}

\ifboolexpr{bool {xetex} or bool {luatex}}{
  \usepackage{fontspec}
  \defaultfontfeatures{Ligatures=TeX}

  \newcounter{fontsnotfound}
  \newcommand{\checkfont}[1]{%
    \suppressfontnotfounderror=1%
    \font\x = "#1" at 10pt
    \selectfont
    \ifx\x\nullfont%
      \stepcounter{fontsnotfound}%
    \fi%
    \suppressfontnotfounderror=0%
  }
  \newcommand{\iffontsexist}[3]{%
    \setcounter{fontsnotfound}{0}%
    \expandafter\forcsvlist\expandafter%
    \checkfont\expandafter{#1}%
    \ifnum\value{fontsnotfound}=0%
      #2%
    \else%
      #3%
    \fi%
  }
}{
  \typeout{%
    You need to compile with XeLaTeX or LuaLaTeX to use the Fira fonts.%
  }
}

\newcommand{\btVFill}{\vskip0pt plus 1filll}

\usepackage{nccmath}
\usepackage{empheq}
\usepackage[many]{tcolorbox}
\usepackage{ragged2e}
\justifying

\usepackage{subfig}
\usepackage{changepage}
\usepackage{booktabs}
\usepackage[scale=2]{ccicons}
\usepackage{verbatim}
\usepackage[percent]{overpic}
\usepackage[absolute,overlay]{textpos}

\usepackage{array,booktabs}
\usepackage{multirow}
\usepackage{xspace}

\usepackage{adjustbox}
\captionsetup[subfigure]{labelformat=empty}

\usepackage{fancyhdr}

\newcommand{\omrSIZE}{}
\newcommand{\omrSKIP}{.7em}
%%\newcommand{\omrFONT}{\fontspec{[OMRBubbles.ttf]}}
\newcommand{\omrFONT}{\fontspec{OMR}}

\newcommand{\omrDIGITS}{{\omrSIZE \omrFONT \XeTeXglyph 17\hspace{\omrSKIP}\XeTeXglyph 18\hspace{\omrSKIP}\XeTeXglyph 19\hspace{\omrSKIP}\XeTeXglyph 20\hspace{\omrSKIP}\XeTeXglyph 21\hspace{\omrSKIP}\XeTeXglyph 22\hspace{\omrSKIP}\XeTeXglyph 23\hspace{\omrSKIP}\XeTeXglyph 24\hspace{\omrSKIP}\XeTeXglyph 25\hspace{\omrSKIP}\XeTeXglyph 26}}

\newcommand{\omrCHECK}[1]{\raisebox{-6pt}{\scalebox{1}{\tikz{\filldraw[fill=black!57, draw=none] (0, 0) circle (0.25); \node (x1) at (0, 0) {\omrFONT #1};}}}}

\newcommand{\omrNOCHECK}[1]{\raisebox{-6pt}{\scalebox{1}{\tikz{\filldraw[fill=black!0, draw=none] (0, 0) circle (0.25); \node (x1) at (0, 0) {\omrFONT #1};}}}}

\ifcsname ifmyflag\endcsname\else
  \expandafter\let\csname ifmyflag\expandafter\endcsname
                  \csname iffalse\endcsname
                  \fi


\ifmyflag
\newcommand{\iO}{\refstepcounter{enumii}\omrNOCHECK{\alph{enumii}}}
\newcommand{\iX}{\refstepcounter{enumii}\omrCHECK{\alph{enumii}}}
\else
\newcommand{\iO}{\refstepcounter{enumii}\omrNOCHECK{\alph{enumii}}}
\newcommand{\iX}{\refstepcounter{enumii}\omrNOCHECK{\alph{enumii}}}
\fi


\newcommand{\xA}{{\omrCHECK{\XeTeXglyph 66}}}
\newcommand{\xB}{{\omrCHECK{\XeTeXglyph 67}}}
\newcommand{\xC}{{\omrCHECK{\XeTeXglyph 68}}}
\newcommand{\xD}{{\omrCHECK{\XeTeXglyph 69}}}
\newcommand{\xE}{{\omrCHECK{\XeTeXglyph 70}}}
\newcommand{\xF}{{\omrCHECK{\XeTeXglyph 71}}}
\newcommand{\xG}{{\omrCHECK{\XeTeXglyph 72}}}
\newcommand{\xH}{{\omrCHECK{\XeTeXglyph 73}}}
\newcommand{\xI}{{\omrCHECK{\XeTeXglyph 74}}}

\newcommand{\oA}{{\omrNOCHECK{\XeTeXglyph 66}}}
\newcommand{\oB}{{\omrNOCHECK{\XeTeXglyph 67}}}
\newcommand{\oC}{{\omrNOCHECK{\XeTeXglyph 68}}}
\newcommand{\oD}{{\omrNOCHECK{\XeTeXglyph 69}}}
\newcommand{\oE}{{\omrNOCHECK{\XeTeXglyph 70}}}
\newcommand{\oF}{{\omrNOCHECK{\XeTeXglyph 71}}}
\newcommand{\oG}{{\omrNOCHECK{\XeTeXglyph 72}}}
\newcommand{\oH}{{\omrNOCHECK{\XeTeXglyph 73}}}
\newcommand{\oI}{{\omrNOCHECK{\XeTeXglyph 74}}}

\newcommand{\oT}{{\omrNOCHECK{\XeTeXglyph 85}}}
\newcommand{\xT}{{\omrCHECK{\XeTeXglyph 85}}}

\newcommand{\Q}[1]{{\\[1em]{\bf\textit Q#1. }}}


\ifmyflag
     \newenvironment{answer}[1][]
     {\par\medskip 
      \noindent \color{red} }
     { \medskip }
\else
\usepackage{environ}

\NewEnviron{answer}{%
\par  \medskip   \medskip

}

\fi

\usepackage{tabto}
\usepackage{multicol}


\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
  \hbox{}
  \vspace*{\fill}
  \begin{center}
    This page was intentionally left blank.
  \end{center}
  \vspace{\fill}
  \thispagestyle{empty}
  \newpage
  \if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother



\begin{document}
\pagestyle{plain}
\maketitle


\cleardoublepage


\vspace*{-4em}
\begin{minipage}[t]{.6\linewidth}
Exam Number: \tabto{3cm} \underline{\hspace{6cm}}

Seat Number : \tabto{3.5cm} \underline{\hspace{5.5cm}}
\end{minipage}
\begin{minipage}[t]{.4\linewidth}
  Mark your exam number below

  \omrDIGITS

  \omrDIGITS

  \omrDIGITS

  \omrDIGITS

  \omrDIGITS
      
\end{minipage}

\vspace{1em}
{\bf 
  All your MCQ answers must be filled in on this answer page. 
}

For {\bf True} or {\bf False} questions, mark \oT or \oF. For
questions with multiple choices, mark all solutions that are correct
(for instance \xA\xB\oC\xD).

\vspace{0.5em}

\begin{multicols}{3}
\begin{enumerate}
<| set letter = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N'] |>
<| for q in questions +|>
\item[{\bf Q.<<loop.index>>}]
<|- if q.type == 'essay' |>
essay question
<|- elif q.type == 'mc' or q.type == 'ma' |>
<|-   for a in q.answers -|>
<|-     if a.correct  -|>
\ifmyflag\x<<letter[loop.index0]>>\else\o<<letter[loop.index0]>>\fi
<|-     else  -|>
\o<<letter[loop.index0]>>
<|- endif -|>
<|-   endfor |>
<| endif |>
<| endfor |>
\end{enumerate}
\end{multicols}

\cleardoublepage

<| for q in questions |>
<| if q.type == 'essay' |>
\begin{bbquestion}[<<q.marks>>]
<<q.question>>
\end{bbquestion}
\begin{answer}
<<q.answer>>
\end{answer}
<| elif q.type == 'mc' or q.type == 'ma' |>
\begin{bbquestion}[<<q.marks>>]
<<q.question>>
  \vspace{1em}
  \begin{enumerate}\setcounter{enumii}{0}\setlength\itemsep{0em}
<|-   for a in q.answers |>
  
<|        if a.correct   -|>
    \item[\iX] <<a.answer>>
<|-        else          -|>  
    \item[\iO] <<a.answer>>
<|-        endif          |>  
<|-    endfor +|>
  \end{enumerate}
\end{bbquestion}
<| endif |>  
<| endfor |>

\end{document}

